<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a5f7a">
    <title>MyInsurancePhoto.com - Bill Layne Insurance</title>
    
    <!-- Modern Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #1a5f7a;
            --secondary: #457b9d;
            --accent: #a8dadc;
            --background: #f8f9fa;
            --text: #2c3e50;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --radius: 12px;
            --radius-lg: 16px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Plus Jakarta Sans', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--background) 0%, #e1f5f9 100%);
            min-height: 100vh;
            padding: 10px;
            color: var(--text);
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 6px rgba(0,0,0,0.07), 0 10px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        /* Header - Enhanced with brand colors */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header-logo {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header h1 {
            font-size: 22px;
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 13px;
            opacity: 0.9;
        }
        
        /* Quick Action Bar */
        .quick-action-bar {
            background: linear-gradient(135deg, #f0f9ff 0%, var(--accent) 10%);
            padding: 15px;
            border-bottom: 1px solid rgba(69, 123, 157, 0.1);
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .action-btn {
            padding: 12px;
            border: 2px solid var(--accent);
            background: white;
            border-radius: var(--radius);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text);
        }
        
        .action-btn.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }
        
        .action-btn:active {
            transform: scale(0.98);
        }
        
        /* Main Content Area */
        .main-content {
            padding: 20px;
        }
        
        /* Priority Section - Photo Upload */
        .priority-section {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border: 2px solid var(--warning);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .priority-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            font-weight: 700;
            color: #92400e;
            margin-bottom: 15px;
        }
        
        /* Category Selection */
        .photo-categories {
            background: white;
            padding: 15px;
            border-radius: var(--radius);
            margin-bottom: 15px;
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .category-tag {
            padding: 10px;
            background: var(--background);
            border: 2px solid transparent;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text);
        }
        
        .category-tag.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        /* Upload Box */
        .upload-box {
            background: white;
            border: 3px dashed var(--primary);
            border-radius: var(--radius);
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .upload-box:hover {
            background: linear-gradient(135deg, #f0f9ff 0%, rgba(168, 218, 220, 0.1) 100%);
            border-color: var(--secondary);
        }
        
        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .upload-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .upload-btn {
            padding: 15px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            transition: transform 0.2s ease;
        }
        
        .upload-btn:active {
            transform: scale(0.96);
        }
        
        /* Image Preview with Categories */
        .image-preview {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            background: var(--background);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .preview-item .category-label {
            position: absolute;
            bottom: 2px;
            left: 2px;
            right: 2px;
            background: rgba(26, 95, 122, 0.9);
            color: white;
            font-size: 10px;
            padding: 2px 4px;
            border-radius: 4px;
            text-align: center;
        }
        
        .preview-item .remove-btn {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(239,68,68,0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Section Styling */
        .section {
            margin-bottom: 15px;
            border: 1px solid rgba(69, 123, 157, 0.2);
            border-radius: var(--radius);
            overflow: hidden;
            background: white;
        }
        
        .section-header {
            background: linear-gradient(135deg, var(--background) 0%, rgba(168, 218, 220, 0.2) 100%);
            padding: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 600;
            color: var(--text);
            transition: background 0.2s ease;
        }
        
        .section-header:hover {
            background: linear-gradient(135deg, rgba(168, 218, 220, 0.2) 0%, rgba(168, 218, 220, 0.3) 100%);
        }
        
        .section-header.active {
            background: linear-gradient(135deg, rgba(26, 95, 122, 0.1) 0%, rgba(69, 123, 157, 0.1) 100%);
            color: var(--primary);
        }
        
        .section-icon {
            font-size: 20px;
            margin-right: 10px;
        }
        
        .section-arrow {
            transition: transform 0.3s ease;
            font-size: 12px;
            color: var(--secondary);
        }
        
        .section.expanded .section-arrow {
            transform: rotate(180deg);
        }
        
        .section-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }
        
        .section.expanded .section-content {
            padding: 15px;
            max-height: 800px;
        }
        
        /* Form Fields */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 6px;
        }
        
        .required {
            color: var(--danger);
        }
        
        .optional-tag {
            font-size: 11px;
            color: var(--secondary);
            font-weight: 400;
            margin-left: 5px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1.5px solid rgba(69, 123, 157, 0.2);
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.2s ease;
            background: white;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.08);
        }
        
        /* Submit Button */
        .submit-section {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 15px 20px;
            border-top: 2px solid rgba(69, 123, 157, 0.1);
            box-shadow: 0 -4px 12px rgba(0,0,0,0.08);
        }
        
        .submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .submit-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(26, 95, 122, 0.3);
        }
        
        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Upload Progress Bar */
        .upload-progress {
            margin-top: 10px;
            background: var(--background);
            border-radius: 20px;
            height: 8px;
            overflow: hidden;
            display: none;
        }
        
        .upload-progress.active {
            display: block;
        }
        
        .upload-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 20px;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .upload-status {
            font-size: 12px;
            color: var(--secondary);
            margin-top: 5px;
            text-align: center;
            display: none;
        }
        
        .upload-status.active {
            display: block;
        }
        
        /* Photo Counter Badge */
        .photo-counter {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        /* Trust Badges */
        .trust-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 10px;
            background: var(--background);
            font-size: 12px;
            color: var(--text);
            text-align: center;
        }
        
        .trust-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            background: var(--background);
            color: var(--text);
            font-size: 12px;
            line-height: 1.6;
        }
        
        .footer img {
            max-width: 120px;
            margin: 0 auto 10px;
        }
        
        /* Success Message */
        .success-banner {
            display: none;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 1px solid var(--success);
            color: #166534;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }
        
        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            color: var(--primary);
            font-size: 14px;
            margin-left: 5px;
        }
        
        .tooltip-content {
            visibility: hidden;
            width: 250px;
            background: var(--text);
            color: white;
            text-align: left;
            border-radius: 8px;
            padding: 10px;
            position: absolute;
            z-index: 100;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .tooltip:hover .tooltip-content {
            visibility: visible;
            opacity: 1;
        }
        
        /* Network status indicator */
        .network-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: none;
            align-items: center;
            gap: 5px;
            z-index: 1000;
        }
        
        .network-status.online {
            background: var(--success);
            color: white;
        }
        
        .network-status.offline {
            background: var(--danger);
            color: white;
        }
        
        .network-status.slow {
            background: var(--warning);
            color: white;
        }
        
        /* Mobile Optimizations */
        @media (max-width: 480px) {
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .upload-buttons {
                grid-template-columns: 1fr;
            }
            
            .image-preview {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .category-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Loading state */
        .spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* File input hidden */
        .file-input {
            display: none;
        }
        
        /* Photo tips card */
        .photo-tips {
            background: linear-gradient(135deg, #eff6ff 0%, #f0f9ff 100%);
            border-left: 3px solid var(--primary);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .photo-tips h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary);
            margin: 0 0 10px 0;
        }
        
        .photo-tips ul {
            margin: 0;
            padding-left: 20px;
            font-size: 13px;
            color: var(--text);
            line-height: 1.8;
        }
        
        .photo-tips .tip {
            margin-top: 12px;
            color: var(--primary);
            font-size: 13px;
            font-weight: 600;
        }
        
        /* Confirmation options */
        .confirmation-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .confirm-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .email-btn {
            background: var(--primary);
            color: white;
        }
        
        .sms-btn {
            background: var(--success);
            color: white;
        }
    </style>
</head>
<body>
    <!-- Network Status Indicator -->
    <div class="network-status" id="networkStatus">
        <span id="networkIcon">üì∂</span>
        <span id="networkText">Online</span>
    </div>
    
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-logo">üè†üöó</div>
            <h1>MyInsurancePhoto.com</h1>
            <p>Quick & Secure Photo Upload</p>
        </div>
        
        <!-- Quick Selection Bar -->
        <div class="quick-action-bar">
            <div style="font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 10px; text-align: center;">
                Select what you're uploading:
            </div>
            <div class="action-buttons">
                <button type="button" class="action-btn active" data-selection="home">
                    <span>üè†</span>
                    <span>Home</span>
                </button>
                <button type="button" class="action-btn" data-selection="vehicle">
                    <span>üöó</span>
                    <span>Vehicle</span>
                </button>
                <button type="button" class="action-btn" data-selection="forms">
                    <span>üìÑ</span>
                    <span>Forms</span>
                </button>
                <button type="button" class="action-btn" data-selection="claim">
                    <span>üö®</span>
                    <span>Claim</span>
                </button>
            </div>
        </div>
        
        <!-- Main Form -->
        <form id="imageForm">
            <div class="main-content">
                <!-- Success Banner -->
                <div class="success-banner" id="successBanner">
                    ‚úì Photos uploaded successfully!
                </div>
                
                <!-- Priority Upload Section -->
                <div class="priority-section">
                    <div class="priority-title">
                        <span>üì∏</span>
                        <span>Upload Your Photos</span>
                        <span class="photo-counter" id="photoCounter">0</span>
                        <span class="tooltip">‚ÑπÔ∏è
                            <div class="tooltip-content" id="photoTooltip">
                                ‚Ä¢ High quality photos help us serve you better<br>
                                ‚Ä¢ All files are encrypted and secure<br>
                                ‚Ä¢ Maximum file size: 20MB
                            </div>
                        </span>
                    </div>
                    
                    <!-- Category Selection -->
                    <div class="photo-categories" id="photoCategories">
                        <h5 style="font-size: 13px; font-weight: 600; margin-bottom: 8px;">Tag your photos (optional):</h5>
                        <div class="category-grid">
                            <button type="button" class="category-tag" data-category="front">
                                Front View
                            </button>
                            <button type="button" class="category-tag" data-category="side">
                                Side View
                            </button>
                            <button type="button" class="category-tag" data-category="damage">
                                Damage Area
                            </button>
                            <button type="button" class="category-tag" data-category="document">
                                Document
                            </button>
                        </div>
                    </div>
                    
                    <!-- Photo Tips (Dynamic based on selection) -->
                    <div class="photo-tips" id="photoTips">
                        <h4>üè† How to Photograph Your Property:</h4>
                        <ul>
                            <li><strong>Front of house</strong> - Stand back to capture entire front</li>
                            <li><strong>Back of house</strong> - Include deck/patio if present</li>
                            <li><strong>All sides</strong> - Show full side from corner to corner</li>
                            <li><strong>Roof angle</strong> - Best visible angle showing condition</li>
                            <li><strong>Special features</strong> - Pool, solar panels, detached structures</li>
                        </ul>
                        <p class="tip">üí° Tip: Take photos during daylight for best results</p>
                    </div>
                    
                    <!-- Upload Area -->
                    <div class="upload-box" id="uploadArea">
                        <div class="upload-icon">üì∑</div>
                        <div style="font-size: 16px; font-weight: 600; color: var(--text);">
                            Tap to Add Photos
                        </div>
                        <div style="font-size: 13px; color: var(--secondary); margin-top: 5px;">
                            or drag and drop files here
                        </div>
                        
                        <!-- Updated file inputs with better mobile camera capture -->
                        <input type="file" id="fileInput" class="file-input" accept="image/*,application/pdf" multiple>
                        <input type="file" id="cameraInput" class="file-input" accept="image/*" capture="environment">
                        
                        <div class="upload-buttons">
                            <button type="button" class="upload-btn" id="cameraBtn">
                                <span style="font-size: 24px;">üì∑</span>
                                <span>Camera</span>
                            </button>
                            <button type="button" class="upload-btn" id="galleryBtn">
                                <span style="font-size: 24px;">üñºÔ∏è</span>
                                <span>Gallery</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Image Preview -->
                    <div class="image-preview" id="imagePreview"></div>
                    
                    <!-- Upload Progress -->
                    <div class="upload-progress" id="uploadProgress">
                        <div class="upload-progress-bar" id="uploadProgressBar"></div>
                    </div>
                    <div class="upload-status" id="uploadStatusText">Preparing upload...</div>
                </div>
                
                <!-- Contact Info Section (Collapsible) -->
                <div class="section expanded" id="contactSection">
                    <div class="section-header">
                        <div>
                            <span class="section-icon">üë§</span>
                            <span>Contact Information</span>
                            <span style="color: var(--danger); font-size: 18px; margin-left: 5px;">*</span>
                        </div>
                        <span class="section-arrow">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label>
                                Full Name <span class="required">*</span>
                            </label>
                            <input type="text" name="customerName" id="customerName" required autocomplete="name">
                        </div>
                        <div class="form-group">
                            <label>
                                Phone <span class="required">*</span>
                            </label>
                            <input type="tel" name="phone" id="phone" required placeholder="(336) 555-1234" autocomplete="tel">
                        </div>
                        <div class="form-group">
                            <label>
                                Email <span class="optional-tag">(optional)</span>
                            </label>
                            <input type="email" name="email" id="email" autocomplete="email">
                        </div>
                    </div>
                </div>
                
                <!-- Property/Vehicle Details Section -->
                <div class="section" id="detailsSection">
                    <div class="section-header">
                        <div>
                            <span class="section-icon">üìç</span>
                            <span id="detailsTitle">Property Details</span>
                            <span class="optional-tag">(optional)</span>
                        </div>
                        <span class="section-arrow">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <!-- Property Fields -->
                        <div id="propertyFields">
                            <div class="form-group">
                                <label>Address</label>
                                <input type="text" name="address" id="address" autocomplete="street-address">
                            </div>
                            <div class="form-group">
                                <label>City</label>
                                <input type="text" name="city" id="city" autocomplete="address-level2">
                            </div>
                            <div class="form-group">
                                <label>ZIP</label>
                                <input type="text" name="zip" id="zip" maxlength="5" autocomplete="postal-code">
                            </div>
                        </div>
                        
                        <!-- Vehicle Fields (hidden by default) -->
                        <div id="vehicleFields" style="display: none;">
                            <div class="form-group">
                                <label>Vehicle Info</label>
                                <input type="text" name="vehicleInfo" id="vehicleInfo" 
                                       placeholder="Year Make Model or VIN">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Notes <span class="optional-tag">(optional)</span></label>
                            <textarea name="notes" id="notes" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Trust Row -->
                <div class="trust-row">
                    <div class="trust-item">
                        <span>üîí</span>
                        <span>Encrypted</span>
                    </div>
                    <div class="trust-item">
                        <span>‚ö°</span>
                        <span>Fast Upload</span>
                    </div>
                    <div class="trust-item">
                        <span>‚úì</span>
                        <span>Direct to Agent</span>
                    </div>
                </div>
            </div>
            
            <!-- Sticky Submit Button -->
            <div class="submit-section">
                <button type="submit" class="submit-btn" id="submitBtn">
                    <span id="btnText">Submit Photos to Agency</span>
                    <div class="spinner" id="spinner"></div>
                </button>
            </div>
        </form>
        
        <!-- Footer -->
        <div class="footer">
            <img src="https://i.imgur.com/cBAgeX8.png" alt="Bill Layne Insurance Logo" loading="lazy">
            <div style="margin-top: 10px;">
                <strong>Bill Layne Insurance Agency</strong><br>
                1283 N Bridge St, Elkin NC 28621<br>
                336-835-1993 ‚Ä¢ Save@BillLayneInsurance.com<br>
                <a href="https://www.BillLayneInsurance.com" style="color: var(--primary); text-decoration: none;">www.BillLayneInsurance.com</a>
            </div>
        </div>
    </div>
    
    <!-- Enhanced Upload Progress Modal -->
    <div class="modal-overlay" id="uploadProgressModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; justify-content: center; align-items: center;">
        <div class="modal-content" style="background: white; border-radius: 20px; padding: 35px 25px; max-width: 420px; width: 90%; text-align: center; box-shadow: 0 25px 50px rgba(0,0,0,0.2);">
            <div style="width: 64px; height: 64px; margin: 0 auto 20px;">
                <div class="spinner" style="display: block; width: 64px; height: 64px; border: 4px solid rgba(26,95,122,0.2); border-top-color: var(--primary);"></div>
            </div>
            <h2 style="font-size: 20px; font-weight: 700; color: var(--primary); margin-bottom: 12px;">
                Uploading Your Photos
            </h2>
            <p style="font-size: 14px; color: var(--text); margin-bottom: 20px;">
                Please wait while we securely upload your images...
            </p>
            <div style="background: var(--background); border-radius: 20px; height: 8px; overflow: hidden;">
                <div id="modalProgressBar" style="height: 100%; background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%); 
                     border-radius: 20px; width: 0%; transition: width 0.5s ease;"></div>
            </div>
            <p style="margin-top: 15px; font-size: 13px; color: var(--secondary);">
                <span id="modalUploadStatus">Preparing upload...</span>
            </p>
            <div id="retryInfo" style="display: none; margin-top: 15px; padding: 10px; background: var(--warning); color: white; border-radius: 8px; font-size: 12px;">
                Network issue detected. Retrying...
            </div>
        </div>
    </div>
    
    <!-- Enhanced Success Modal -->
    <div class="modal-overlay" id="successModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; justify-content: center; align-items: center;">
        <div class="modal-content" style="background: white; border-radius: 20px; padding: 35px 25px; max-width: 420px; width: 90%; text-align: center; box-shadow: 0 25px 50px rgba(0,0,0,0.2);">
            <div class="success-icon" style="width: 80px; height: 80px; margin: 0 auto 20px; background: linear-gradient(135deg, var(--success) 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <span style="font-size: 40px; color: white;">‚úì</span>
            </div>
            <h2 style="font-size: 24px; font-weight: 700; color: #166534; margin-bottom: 12px;">Success! Submission Received</h2>
            <p style="font-size: 15px; color: var(--text); line-height: 1.5; margin-bottom: 25px;">
                Thank you! We've received your photos and information. Our team will review them promptly.
            </p>
            <div style="background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px;">Your Reference Number</div>
                <div id="confirmNumber" style="font-size: 24px; font-weight: 700; letter-spacing: 1px; margin-bottom: 8px;">BLI-240101-0000</div>
                <div style="font-size: 12px; opacity: 0.85;">Please save this for your records</div>
            </div>
            
            <!-- Confirmation Options -->
            <div class="confirmation-options">
                <button class="confirm-btn email-btn" onclick="sendEmailConfirmation()">
                    üìß Email Receipt
                </button>
                <button class="confirm-btn sms-btn" onclick="sendSMSConfirmation()">
                    üì± Text Receipt
                </button>
            </div>
            
            <button onclick="closeSuccessModal()" style="width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 15px;">Done</button>
        </div>
    </div>
    
    <script>
        // Configuration
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzgRcVZgCDznG5bBTLpAxun6enA4OP4k6HQhYHYeyq4nkFNKxBkFg3QVQr5n9p9olAlag/exec';
        const MAX_FILE_SIZE = 20 * 1024 * 1024; // 20MB
        const MAX_RETRIES = 3;
        const COMPRESSION_QUALITY = 0.85;
        const MAX_IMAGE_WIDTH = 1600;
        
        // Allowed file types
        const ALLOWED_TYPES = {
            'image/jpeg': ['.jpg', '.jpeg'],
            'image/png': ['.png'],
            'image/webp': ['.webp'],
            'application/pdf': ['.pdf']
        };
        
        // State
        let selectedOption = 'home';
        let uploadedImages = [];
        let selectedCategory = null;
        let networkStatus = 'online';
        let uploadAttempt = 0;
        
        // Photo requirements by type
        const photoTips = {
            'home': {
                icon: 'üè†',
                title: 'How to Photograph Your Property:',
                tips: [
                    '<strong>Front of house</strong> - Stand back to capture entire front',
                    '<strong>Back of house</strong> - Include deck/patio if present',
                    '<strong>All sides</strong> - Show full side from corner to corner',
                    '<strong>Roof angle</strong> - Best visible angle showing condition',
                    '<strong>Special features</strong> - Pool, solar panels, detached structures'
                ],
                hint: 'Take photos during daylight for best results'
            },
            'vehicle': {
                icon: 'üöó',
                title: 'How to Photograph Your Vehicle:',
                tips: [
                    '<strong>Front view</strong> - Stand directly in front, include license plate',
                    '<strong>Back view</strong> - Stand directly behind, include license plate',
                    '<strong>Both sides</strong> - Full side view from front to back',
                    '<strong>VIN number</strong> - Dashboard or driver door frame',
                    '<strong>Odometer</strong> - Current mileage reading'
                ],
                hint: 'Park in open area with good lighting'
            },
            'forms': {
                icon: 'üìÑ',
                title: 'Document Photo Tips:',
                tips: [
                    'Place document on flat surface',
                    'Ensure good lighting (no shadows)',
                    'Capture entire document in frame',
                    'Make sure text is readable',
                    'Take photos straight down (not angled)'
                ],
                hint: 'Use your phone\'s scanner mode if available'
            },
            'claim': {
                icon: 'üö®',
                title: 'How to Document Damage/Claims:',
                tips: [
                    '<strong>Overall damage view</strong> - Wide shots showing full extent',
                    '<strong>Each damaged area</strong> - Individual close-up photos',
                    '<strong>Multiple angles</strong> - Same damage from different perspectives',
                    '<strong>Measurement reference</strong> - Include ruler or common object for scale',
                    '<strong>Exchange forms</strong> - Clear photo of all insurance documents'
                ],
                hint: 'Take photos before any cleanup or repairs'
            }
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updatePhotoTips();
            monitorNetworkStatus();
            setupDragAndDrop();
        });
        
        // Setup all event listeners
        function setupEventListeners() {
            // Selection buttons
            document.querySelectorAll('.action-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.action-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedOption = this.dataset.selection;
                    updateUI();
                    updatePhotoTips();
                });
            });
            
            // Category tags
            document.querySelectorAll('.category-tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    document.querySelectorAll('.category-tag').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    selectedCategory = this.dataset.category;
                });
            });
            
            // Collapsible sections
            document.querySelectorAll('.section-header').forEach(header => {
                header.addEventListener('click', function() {
                    const section = this.parentElement;
                    section.classList.toggle('expanded');
                    this.classList.toggle('active');
                });
            });
            
            // Upload area
            document.getElementById('uploadArea').addEventListener('click', function(e) {
                if (!e.target.closest('.upload-btn')) {
                    document.getElementById('fileInput').click();
                }
            });
            
            // Camera/Gallery buttons
            document.getElementById('cameraBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                document.getElementById('cameraInput').click();
            });
            
            document.getElementById('galleryBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                document.getElementById('fileInput').click();
            });
            
            // File inputs
            document.getElementById('fileInput').addEventListener('change', handleFileSelect);
            document.getElementById('cameraInput').addEventListener('change', handleFileSelect);
            
            // Form submission
            document.getElementById('imageForm').addEventListener('submit', handleSubmit);
            
            // Phone formatting
            document.getElementById('phone').addEventListener('input', formatPhone);
            
            // ZIP formatting
            document.getElementById('zip').addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/\D/g, '').slice(0, 5);
            });
        }
        
        // Setup drag and drop
        function setupDragAndDrop() {
            const uploadArea = document.getElementById('uploadArea');
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.background = 'var(--accent)';
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.background = 'white';
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.background = 'white';
                handleFiles(Array.from(e.dataTransfer.files));
            });
        }
        
        // Monitor network status
        function monitorNetworkStatus() {
            const statusEl = document.getElementById('networkStatus');
            const iconEl = document.getElementById('networkIcon');
            const textEl = document.getElementById('networkText');
            
            function updateStatus(status) {
                networkStatus = status;
                statusEl.className = 'network-status ' + status;
                
                if (status === 'online') {
                    iconEl.textContent = 'üì∂';
                    textEl.textContent = 'Online';
                    statusEl.style.display = 'none';
                } else if (status === 'offline') {
                    iconEl.textContent = 'üìµ';
                    textEl.textContent = 'Offline';
                    statusEl.style.display = 'flex';
                } else if (status === 'slow') {
                    iconEl.textContent = '‚ö†Ô∏è';
                    textEl.textContent = 'Slow Connection';
                    statusEl.style.display = 'flex';
                }
            }
            
            window.addEventListener('online', () => updateStatus('online'));
            window.addEventListener('offline', () => updateStatus('offline'));
            
            // Check connection speed
            if ('connection' in navigator) {
                const connection = navigator.connection;
                connection.addEventListener('change', () => {
                    if (connection.effectiveType === '2g' || connection.effectiveType === 'slow-2g') {
                        updateStatus('slow');
                    } else {
                        updateStatus('online');
                    }
                });
            }
        }
        
        // Update UI based on selection
        function updateUI() {
            const propFields = document.getElementById('propertyFields');
            const vehFields = document.getElementById('vehicleFields');
            const detailsTitle = document.getElementById('detailsTitle');
            
            if (selectedOption === 'home' || selectedOption === 'forms') {
                propFields.style.display = 'block';
                vehFields.style.display = 'none';
                detailsTitle.textContent = 'Property Details';
            } else {
                propFields.style.display = 'none';
                vehFields.style.display = 'block';
                detailsTitle.textContent = 'Vehicle Details';
            }
        }
        
        // Update photo tips based on selection
        function updatePhotoTips() {
            const tipsEl = document.getElementById('photoTips');
            const tips = photoTips[selectedOption];
            
            if (tips) {
                tipsEl.innerHTML = `
                    <h4>${tips.icon} ${tips.title}</h4>
                    <ul>
                        ${tips.tips.map(tip => `<li>${tip}</li>`).join('')}
                    </ul>
                    <p class="tip">üí° Tip: ${tips.hint}</p>
                `;
            }
        }
        
        // Format phone number
        function formatPhone() {
            const input = document.getElementById('phone');
            let value = input.value.replace(/\D/g, '');
            
            if (value.length > 0) {
                if (value.length <= 3) {
                    value = `(${value}`;
                } else if (value.length <= 6) {
                    value = `(${value.slice(0, 3)}) ${value.slice(3)}`;
                } else {
                    value = `(${value.slice(0, 3)}) ${value.slice(3, 6)}-${value.slice(6, 10)}`;
                }
            }
            
            input.value = value;
        }
        
        // Validate file
        function validateFile(file) {
            // Check MIME type
            if (!ALLOWED_TYPES[file.type]) {
                return { valid: false, error: `File type ${file.type} not allowed` };
            }
            
            // Check extension
            const extension = '.' + file.name.split('.').pop().toLowerCase();
            if (!ALLOWED_TYPES[file.type].includes(extension)) {
                return { valid: false, error: 'File extension mismatch' };
            }
            
            // Check for double extensions or suspicious patterns
            const fileName = file.name.toLowerCase();
            if (fileName.includes('..') || fileName.match(/\.(exe|scr|bat|cmd|com|pif|msi|jar|app)/)) {
                return { valid: false, error: 'Suspicious filename detected' };
            }
            
            // Size check
            if (file.size > MAX_FILE_SIZE) {
                return { valid: false, error: `File exceeds ${MAX_FILE_SIZE / 1024 / 1024}MB limit` };
            }
            
            return { valid: true };
        }
        
        // Compress image
        async function compressImage(file) {
            // Skip compression for PDFs
            if (file.type === 'application/pdf') {
                return file;
            }
            
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    const img = new Image();
                    
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        // Calculate new dimensions
                        if (width > MAX_IMAGE_WIDTH) {
                            height = (MAX_IMAGE_WIDTH / width) * height;
                            width = MAX_IMAGE_WIDTH;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        const ctx = canvas.getContext('2d');
                        
                        // Handle EXIF orientation
                        // This is simplified - in production you'd use a library like EXIF.js
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        canvas.toBlob(
                            (blob) => {
                                const compressedFile = new File([blob], file.name, {
                                    type: 'image/jpeg',
                                    lastModified: Date.now()
                                });
                                resolve(compressedFile);
                            },
                            'image/jpeg',
                            COMPRESSION_QUALITY
                        );
                    };
                    
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // Handle file selection
        async function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            await handleFiles(files);
            e.target.value = ''; // Reset input
        }
        
        // Process files
        async function handleFiles(files) {
            const progressBar = document.getElementById('uploadProgress');
            const progressBarEl = document.getElementById('uploadProgressBar');
            const statusText = document.getElementById('uploadStatusText');
            
            progressBar.classList.add('active');
            statusText.classList.add('active');
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // Update progress
                const progress = ((i + 1) / files.length) * 100;
                progressBarEl.style.width = `${progress}%`;
                statusText.textContent = `Processing file ${i + 1} of ${files.length}...`;
                
                // Validate file
                const validation = validateFile(file);
                if (!validation.valid) {
                    alert(validation.error);
                    continue;
                }
                
                try {
                    // Compress if it's an image
                    const processedFile = file.type.startsWith('image/') 
                        ? await compressImage(file) 
                        : file;
                    
                    // Convert to base64
                    const base64 = await fileToBase64(processedFile);
                    
                    uploadedImages.push({
                        data: base64,
                        type: processedFile.type,
                        name: processedFile.name,
                        size: processedFile.size,
                        category: selectedCategory,
                        originalSize: file.size,
                        compressed: file.size !== processedFile.size
                    });
                    
                } catch (error) {
                    console.error('Error processing file:', error);
                    alert(`Failed to process ${file.name}`);
                }
            }
            
            displayImages();
            
            // Hide progress after a short delay
            setTimeout(() => {
                progressBar.classList.remove('active');
                statusText.classList.remove('active');
                progressBarEl.style.width = '0%';
            }, 500);
        }
        
        // Convert file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // Display uploaded images
        function displayImages() {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            
            uploadedImages.forEach((img, index) => {
                const item = document.createElement('div');
                item.className = 'preview-item';
                
                if (img.type === 'application/pdf') {
                    item.innerHTML = `
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: var(--background); padding: 5px;">
                            <span style="font-size: 24px;">üìÑ</span>
                            <span style="font-size: 9px; word-break: break-all;">${img.name}</span>
                        </div>
                        ${img.category ? `<div class="category-label">${img.category}</div>` : ''}
                        <button type="button" class="remove-btn" onclick="removeImage(${index})">√ó</button>
                    `;
                } else {
                    item.innerHTML = `
                        <img src="${img.data}" alt="Photo ${index + 1}">
                        ${img.category ? `<div class="category-label">${img.category}</div>` : ''}
                        <button type="button" class="remove-btn" onclick="removeImage(${index})">√ó</button>
                    `;
                }
                preview.appendChild(item);
            });
            
            // Update counter
            document.getElementById('photoCounter').textContent = uploadedImages.length;
            
            // Show compression savings if applicable
            const totalOriginal = uploadedImages.reduce((sum, img) => sum + (img.originalSize || img.size), 0);
            const totalCompressed = uploadedImages.reduce((sum, img) => sum + img.size, 0);
            const savings = totalOriginal - totalCompressed;
            
            if (savings > 0) {
                const savingsPercent = Math.round((savings / totalOriginal) * 100);
                console.log(`Compression saved ${(savings / 1024 / 1024).toFixed(2)}MB (${savingsPercent}%)`);
            }
        }
        
        // Remove image
        function removeImage(index) {
            uploadedImages.splice(index, 1);
            displayImages();
        }
        
        // Submit form with retry logic
        async function handleSubmit(e) {
            e.preventDefault();
            
            if (uploadedImages.length === 0) {
                alert('Please upload at least one photo');
                return;
            }
            
            // Check network status
            if (networkStatus === 'offline') {
                alert('You appear to be offline. Please check your connection and try again.');
                return;
            }
            
            const submitBtn = document.getElementById('submitBtn');
            const btnText = document.getElementById('btnText');
            const spinner = document.getElementById('spinner');
            
            // Disable button and show spinner
            submitBtn.disabled = true;
            btnText.style.display = 'none';
            spinner.style.display = 'block';
            
            // Show upload progress modal
            const uploadModal = document.getElementById('uploadProgressModal');
            uploadModal.style.display = 'flex';
            
            // Generate reference number
            const referenceNumber = generateReferenceNumber();
            
            // Prepare data
            const formData = new FormData(e.target);
            const data = {
                type: getSelectedType(),
                purpose: getSelectedPurpose(),
                selection: selectedOption,
                customerName: formData.get('customerName'),
                phone: formData.get('phone'),
                email: formData.get('email'),
                address: formData.get('address'),
                city: formData.get('city'),
                zip: formData.get('zip'),
                vehicleInfo: formData.get('vehicleInfo'),
                notes: formData.get('notes'),
                images: uploadedImages,
                referenceNumber: referenceNumber,
                submittedAt: new Date().toISOString(),
                deviceInfo: {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    screenResolution: `${window.screen.width}x${window.screen.height}`
                }
            };
            
            // Try to upload with retry logic
            const result = await uploadWithRetry(data);
            
            if (result.success) {
                // Update confirmation number
                document.getElementById('confirmNumber').textContent = referenceNumber;
                
                // Store data for confirmations
                window.submissionData = data;
                
                // Hide upload modal and show success
                uploadModal.style.display = 'none';
                document.getElementById('successModal').style.display = 'flex';
                
            } else {
                // Show error
                uploadModal.style.display = 'none';
                alert('Upload failed after multiple attempts. Please try again or call 336-835-1993');
            }
            
            // Reset button state
            submitBtn.disabled = false;
            btnText.style.display = 'inline';
            spinner.style.display = 'none';
        }
        
        // Upload with retry logic
        async function uploadWithRetry(data, retryCount = 0) {
            const maxRetries = networkStatus === 'slow' ? 5 : MAX_RETRIES;
            
            try {
                // Update status
                updateUploadStatus(`Uploading... ${retryCount > 0 ? `(Retry ${retryCount}/${maxRetries})` : ''}`);
                
                // Calculate and show progress
                const totalSize = uploadedImages.reduce((sum, img) => sum + img.size, 0);
                await showUploadProgress(totalSize);
                
                // Actual upload
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                // Success
                updateUploadStatus('Upload complete!');
                document.getElementById('modalProgressBar').style.width = '100%';
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                return { success: true };
                
            } catch (error) {
                console.error('Upload error:', error);
                
                if (retryCount < maxRetries) {
                    // Show retry info
                    document.getElementById('retryInfo').style.display = 'block';
                    updateUploadStatus(`Network issue detected. Retrying in 3 seconds...`);
                    
                    // Wait before retry
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    
                    // Retry
                    return uploadWithRetry(data, retryCount + 1);
                }
                
                return { success: false, error };
            }
        }
        
        // Show upload progress
        async function showUploadProgress(totalSize) {
            const progressBar = document.getElementById('modalProgressBar');
            const steps = 10;
            const stepSize = totalSize / steps;
            
            for (let i = 1; i <= steps; i++) {
                const progress = Math.min(90, (i / steps) * 80);
                progressBar.style.width = `${progress}%`;
                
                if (i <= uploadedImages.length) {
                    updateUploadStatus(`Uploading photo ${i} of ${uploadedImages.length}...`);
                } else {
                    updateUploadStatus('Finalizing upload...');
                }
                
                await new Promise(resolve => setTimeout(resolve, 300));
            }
        }
        
        // Update upload status text
        function updateUploadStatus(text) {
            document.getElementById('modalUploadStatus').textContent = text;
        }
        
        // Generate reference number
        function generateReferenceNumber() {
            const date = new Date();
            const year = date.getFullYear().toString().slice(-2);
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            return `BLI-${year}${month}${day}-${random}`;
        }
        
        // Get selected type
        function getSelectedType() {
            return (selectedOption === 'home' || selectedOption === 'forms') ? 'HOME' : 'VEHICLE';
        }
        
        // Get selected purpose
        function getSelectedPurpose() {
            return (selectedOption === 'forms' || selectedOption === 'claim') ? selectedOption : 'property';
        }
        
        // Send email confirmation
        async function sendEmailConfirmation() {
            if (!window.submissionData || !window.submissionData.email) {
                alert('Please provide an email address in the form to receive email confirmation.');
                return;
            }
            
            // In a real implementation, this would call your backend
            alert(`Confirmation email will be sent to ${window.submissionData.email}`);
        }
        
        // Send SMS confirmation
        async function sendSMSConfirmation() {
            if (!window.submissionData || !window.submissionData.phone) {
                alert('Phone number is required for SMS confirmation.');
                return;
            }
            
            // In a real implementation, this would call your backend
            alert(`Confirmation SMS will be sent to ${window.submissionData.phone}`);
        }
        
        // Close success modal
        function closeSuccessModal() {
            document.getElementById('successModal').style.display = 'none';
            // Reset form
            document.getElementById('imageForm').reset();
            uploadedImages = [];
            displayImages();
            selectedCategory = null;
            document.querySelectorAll('.category-tag').forEach(t => t.classList.remove('active'));
        }
    </script>
</body>
</html>

